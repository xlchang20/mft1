var fng;!function(e){(e.directives||(e.directives={})).modelControllerDropdown=function(){return{restrict:"AE",replace:!0,template:'<li ng-show="items.length > 0" class="mcdd" uib-dropdown> <a uib-dropdown-toggle>  {{contextMenu}} <b class="caret"></b> </a> <ul class="uib-dropdown-menu dropdown-menu">  <li ng-repeat="choice in items" ng-hide="isHidden($index)" ng-class="dropdownClass($index)">   <a ng-show="choice.text" class="dropdown-option" ng-href="{{choice.url}}" ng-click="doClick($index, $event)">    {{choice.text}}   </a>  </li> </ul></li>'}}}(fng||(fng={})),function(e){(e.directives||(e.directives={})).errorDisplay=function(){return{restrict:"E",template:'<div id="display-error" ng-show="errorMessage" ng-class="css(\'rowFluid\')">  <div class="alert alert-error col-lg-offset-3 offset3 col-lg-6 col-xs-12 span6 alert-warning alert-dismissable">    <button type="button" class="close" ng-click="dismissError()">×</button>    <h4>{{alertTitle}}</h4>    <div ng-bind-html="errorMessage"></div>  </div></div>'}}}(fng||(fng={})),function(e){!function(e){function t(i,s){return{restrict:"E",scope:{dataSrc:"&model"},link:function(n,e,t){var r=JSON.parse(t.ref),a=t.form;n.readonly=t.readonly,a=a?a+"/":"",t.text&&0<t.text.length&&(n.text=t.text);var o=n.$parent.$index;n.$watch("dataSrc()",function(e){e&&(void 0!==o&&angular.isArray(e)&&(e=e[o]),n.link=i.buildUrl(r.collection+"/"+a+e+"/edit"),n.text||s.getListAttributes(r,e).then(function(e){var t=e.data;!1===t.success?n.text=t.err:n.text=t.list},function(e){n.text="Error "+e.status+": "+e.data}))},!0)},template:function(e,t){return t.readonly?'<span class="fng-link">{{text}}</span>':'<a href="{{ link }}" class="fng-link">{{text}}</a>'}}}t.$inject=["routingService","SubmissionsService"],e.fngLink=t}(e.directives||(e.directives={}))}(fng||(fng={})),function(e){!function(e){function t(e){return{restrict:"A",templateUrl:"form-button-"+e.framework()+".html"}}t.$inject=["cssFrameworkService"],e.formButtons=t}(e.directives||(e.directives={}))}(fng||(fng={})),function(e){!function(e){var L,t;function n(c,d,N,E,y,u,A){return{restrict:"EA",link:function(k,x,s){var w=[],C=L.N,p=function(t,e,n,r,a){function o(){var e;if(angular.isArray(k[t.options]))e={repeat:t.options,value:"option"};else{if(!k[t.options]||!angular.isArray(k[t.options].values))throw new Error("Invalid enumeration setup in field "+t.name);e=angular.isArray(k[t.options].labels)?{repeat:t.options+".values",value:t.options+".values[$index]",label:t.options+".labels[$index]"}:{repeat:t.options+".values",value:t.options+".values[$index]"}}return e}var i;if(!e){var s=(a.model||"record")+".";if(e=s,a.subschema&&-1!==t.name.indexOf(".")){var l=t.name,c=a.subschemaroot,d=l.slice(c.length+1);a.index?r="f_"+(e+=c+"["+a.index+"]."+d).slice(s.length).replace(/(\.|\[|\]\.)/g,"-"):(e+=c,a.subkey?(r=e.slice(s.length).replace(/\./g,"-")+"-subkey"+a.subkeyno+"-"+d,e+="[$_arrayOffset_"+c.replace(/\./g,"_")+"_"+a.subkeyno+"]."+d):(e+="[$index]."+d,r=null,i=l.replace(/\./g,"-")))}else e+=t.name}var u,f,p=A.allInputsVars(k,t,a,e,r,i),m=p.common,h=n||t.required;h=(n=n||t.required)?" required":"";switch(t.type){case"select":t.select2?u='<input placeholder="fng-select2 has been removed" readonly>':(m+=t.readonly?"disabled ":"",m+=t.add?" "+t.add+" ":"",u="<select "+m+'class="'+p.formControl.trim()+p.compactClass+p.sizeClassBS2+'" '+h+">",n||(u+="<option></option>"),angular.isArray(t.options)?angular.forEach(t.options,function(e){_.isObject(e)?u+='<option value="'+(e.val||e.id)+'">'+(e.label||e.text)+"</option>":u+="<option>"+e+"</option>"}):(f=o(),u+='<option ng-repeat="option in '+f.repeat+'"',f.label?u+=' value="{{'+f.value+'}}"> {{ '+f.label+" }} </option> ":u+=">{{"+f.value+"}}</option> "),u+="</select>");break;case"link":"string"==typeof t.ref&&(t.ref={type:"lookup",collection:t.ref},console.warn('Support for string type "ref" property is deprecated - use ref:'+JSON.stringify(t.ref))),u='<fng-link model="'+e+'" ref="'+JSON.stringify(t.ref).replace(/"/g,"&quot;")+'"',t.form&&(u+=' form="'+t.form+'"'),t.linkText&&(u+=' text="'+t.linkText+'"'),t.readonly&&(u+=' readonly="true"'),u+="></fng-link>";break;case"radio":u="",m+=h+(t.readonly?" disabled ":" ");var v="vertical"===a.formstyle||"inline"!==a.formstyle&&!t.inlineRadio;if(angular.isArray(t.options)){var g;a.subschema&&(m=(m=m.replace('name="','name="{{$index}}-')).replace('id="','id="{{$index}}-')),angular.forEach(t.options,function(e,t){g=m.replace('id="','id="'+t+"-"),u+="<input "+g+'type="radio"',u+=' value="'+e+'">'+e,v&&(u+="<br />")})}else{var b=v?"div":"span";a.subschema&&(m=m.replace("$index","$parent.$index").replace('name="','name="{{$parent.$index}}-').replace('id="','id="{{$parent.$index}}-')),f=o(),u+="<"+b+' ng-repeat="option in '+f.repeat+'">',u+="<input "+m.replace('id="','id="{{$index}}-')+' type="radio" value="{{'+f.value+'}}"> {{',u+=f.label||f.value,u+=" }} </"+b+"> "}break;case"checkbox":m+=h+(t.readonly?" disabled ":" "),u="bs3"===y.framework()?'<div class="checkbox"><input '+m+'type="checkbox"></div>':A.generateSimpleInput(m,t,a);break;default:m+=A.addTextInputMarkup(p,t,h),"textarea"===t.type?(t.rows&&("auto"===t.rows?m+='msd-elastic="\n" class="ng-animate" ':m+='rows = "'+t.rows+'" '),"ckEditor"===t.editor&&(console.log('Deprecation Warning: "editor" property deprecated - use "add"'),m+='ckeditor = "" ',"bs3"===y.framework()&&(p.sizeClassBS3="col-xs-12")),u="<textarea "+m+" />"):u=A.generateSimpleInput(m,t,a)}return A.inputChrome(u,t,a,p)},m=function(e){var t;switch(e){case"horizontal":t="form-horizontal";break;case"vertical":t="";break;case"inline":t="form-inline";break;case"horizontalCompact":default:t="form-horizontal compact"}return t},$=function(e){var t={before:"",after:""};if("function"==typeof e.containerType)t=e.containerType(e);else switch(e.containerType){case"tab":for(var n=-1,r=0;r<k.tabs.length;r++)if(k.tabs[r].title===e.title){n=r;break}0<=n?(t.before="<uib-tab select=\"updateQueryForTab('"+e.title+'\')" heading="'+e.title+'"',0<n&&(t.before+='active="tabs['+n+'].active"'),t.before+=">",t.after="</uib-tab>"):(t.before="<p>Error!  Tab "+e.title+" not found in tab list</p>",t.after="");break;case"tabset":t.before="<uib-tabset>",t.after="</uib-tabset>";break;case"well":t.before='<div class="well">',e.title&&(t.before+="<h4>"+e.title+"</h4>"),t.after="</div>";break;case"well-large":t.before='<div class="well well-lg well-large">',t.after="</div>";break;case"well-small":t.before='<div class="well well-sm well-small">',t.after="</div>";break;case"fieldset":t.before="<fieldset>",e.title&&(t.before+="<legend>"+e.title+"</legend>"),t.after="</fieldset>";break;case void 0:case null:case"":break;default:if(t.before='<div class="'+e.containerType+'">',e.title){var a=e.titleTagOrClass||"h4";a.match(/h[1-6]/)?t.before+="<"+a+">"+e.title+"</"+a+">":t.before+='<p class="'+a+'">'+e.title+"</p>"}t.after="</div>"}return t},S=function(e,t){var n=A.fieldChrome(k,e,t),r=n.template;if(e.schema){var a=e.name.replace(/\./g,"_"),o="$_schema_"+a;if(k[o]=e.schema,e.schema)if(e.subkey){e.subkey.path=e.name,k[o+"_subkey"]=e.subkey;for(var i=angular.isArray(e.subkey)?e.subkey:[e.subkey],s=0;s<i.length;s++){var l=$(i[s]);r+=l.before,r+=F(e.schema,null,{subschema:"true",formstyle:t.formstyle,subkey:o+"_subkey",subkeyno:s,subschemaroot:e.name}),r+=l.after}w.push(e)}else if(t.subschema)console.log("Attempts at supporting deep nesting have been removed - will hopefully be re-introduced at a later date");else{var c=(t.model||"record")+"."+e.name;if("string"==typeof e.customHeader)r+=e.customHeader;else{var d="";e.unshift&&(d='<button id="unshift_'+e.id+'_btn" class="add-btn btn btn-default btn-xs btn-mini form-btn" ng-click="unshift(\''+e.name+'\',$event)"><i class="'+A.glyphClass()+'-plus"></i> Add</button>'),"bs3"===y.framework()?r+='<div class="row schema-head"><div class="col-sm-offset-3">'+e.label+d+"</div></div>":r+='<div class="schema-head">'+e.label+d+"</div>"}if(r+='<ol class="sub-doc"'+(e.sortable?' ui-sortable="sortableOptions" ng-model="'+c+'"':"")+">",r+='<li ng-form class="'+("bs2"===y.framework()?"row-fluid ":"")+m(e.formStyle)+'" name="form_'+a+'{{$index}}" class="sub-doc well" id="'+e.id+'List_{{$index}}"  ng-repeat="subDoc in '+c+' track by $index">',"bs2"===y.framework()&&(r+='<div class="row-fluid sub-doc">'),(!0!==e.noRemove||e.customSubDoc)&&(r+='   <div class="sub-doc-btns">',"string"==typeof e.customSubDoc&&(r+=e.customSubDoc),!0!==e.noRemove&&(r+="<button "+(e.noRemove?'ng-hide="'+e.noRemove+'"':"")+' name="remove_'+e.id+'_btn" ng-click="remove(\''+e.name+"', $index, $event)\"",e.remove?r+=' class="remove-btn btn btn-mini btn-default btn-xs form-btn"><i class="'+A.glyphClass()+'-minus"></i> Remove':(r+=' style="position: relative; z-index: 20;" type="button" class="close pull-right">',"bs3"===y.framework()?r+='<span aria-hidden="true">×</span><span class="sr-only">Close</span>':r+="<span>×</span>"),r+="</button>"),r+="</div> "),r+=F(e.schema,!1,{subschema:"true",formstyle:e.formStyle,model:t.model,subschemaroot:e.name}),"bs2"===y.framework()&&(r+="   </div>"),r+="</li>",r+="</ol>",!0!==e.noAdd||"string"==typeof e.customFooter){var u="";"string"==typeof e.customFooter&&(u=e.customFooter),!0!==e.noAdd&&(u+="<button "+(e.noAdd?'ng-hide="'+e.noAdd+'"':"")+' id="add_'+e.id+'_btn" class="add-btn btn btn-default btn-xs btn-mini" ng-click="add(\''+e.name+"',$event)\">\n                                   <i class=\"' + formMarkupHelper.glyphClass() + '-plus\"></i> \n                                   Add\n                                 </button>"),"bs3"===y.framework()?r+='<div class="row schema-foot"><div class="col-sm-offset-3">'+u+"</div></div>":r+='<div class = "schema-foot ">'+u+"</div>"}}}else{var f=A.controlDivClasses(t);if(e.array){if(f.push("fng-array"),"inline"===t.formstyle)throw new Error("Cannot use arrays in an inline form");r+=A.label(k,e,"link"!==e.type,t),r+=A.handleArrayInputAndControlDiv(p(e,"link"===e.type?null:"arrayItem.x",!0,e.id+"_{{$index}}",t),f,e,t)}else r+=A.label(k,e,null,t),t.required&&console.log("*********  Options required - found it ********"),r+=A.handleInputAndControlDiv(p(e,null,t.required,e.id,t),f)}return r+=n.closeTag},D=function(e){e.type=e.type||"text",e.id?("number"==typeof e.id||0<=e.id[0]&&e.id<="9")&&(e.id="_"+e.id):e.id="f_"+e.name.replace(/\./g,"_"),e.label=void 0!==e.label?null===e.label?"":e.label:N("titleCase")(e.name.split(".").slice(-1)[0])},F=function(e,t,n){var r="";if(e)for(var a=0;a<e.length;a++){var o=e[a];0===a&&t&&!n.schema.match(/$_schema_/)&&"object"!=typeof o.add&&(o.add=o.add?" "+o.add+" ":"",-1!==o.add.indexOf("ui-date")||n.noautofocus||o.containerType||(o.add=o.add+"autofocus "));var i=!0;if(o.directive){var s=o.directive,l="<"+s+' model="'+(n.model||"record")+'"',c=x[0];D(o);for(var d=0;d<c.attributes.length;d++){var u=c.attributes[d];switch(u.nodeName){case"class":var f=u.value.replace("ng-scope","");0<f.length&&(l+=' class="'+f+'"');break;case"schema":var p=("bespoke_"+o.name).replace(/\./g,"_");k[p]=angular.copy(o),delete k[p].directive,l+=' schema="'+p+'"';break;default:l+=" "+u.nodeName+'="'+u.value+'"'}}l+=" ";var m=N("camelCase")(o.directive);for(var h in o)if(o.hasOwnProperty(h))switch(h){case"directive":case"schema":break;case"add":switch(typeof o.add){case"string":l+=" "+o.add;break;case"object":for(var v in o.add)l+=" "+v+'="'+o.add[v].toString().replace(/"/g,"&quot;")+'"';break;default:throw new Error("Invalid add property of type "+typeof o.add+" in directive "+o.name)}break;case m:for(var g in o[h])l+=o.directive+"-"+g+'="'+o[h][g]+'"';break;default:o[h]&&("string"==typeof o[h]?l+=" fng-fld-"+h+'="'+o[h].toString().replace(/"/g,"&quot;")+'"':l+=" fng-fld-"+h+'="'+JSON.stringify(o[h]).replace(/"/g,"&quot;")+'"')}for(h in n)n.hasOwnProperty(h)&&"$"!==h[0]&&void 0!==n[h]&&(l+=" fng-opt-"+h+'="'+n[h].toString().replace(/"/g,"&quot;")+'"');r+=l+='ng-model="'+o.name+'"></'+s+">",i=!1}else if(o.containerType){var b=$(o);switch(o.containerType){case"tab":if(C===L.N){C=L.Forced,r+='<uib-tabset active="activeTabNo">';var y=_.findIndex(k.tabs,function(e){return e.active});k.activeTabNo=0<=y?y:0}r+=b.before,r+=F(o.content,null,n),r+=b.after;break;case"tabset":C=L.Y,r+=b.before,r+=F(o.content,null,n),r+=b.after;break;default:r+=b.before,r+=F(o.content,null,n),r+=b.after}i=!1}else if(n.subkey){var w=angular.isArray(k[n.subkey])?k[n.subkey][0].keyList:k[n.subkey].keyList;_.find(w,function(e,t){return k[n.subkey].path+"."+t===o.name})&&(i=!1)}i&&(D(o),r+=S(o,n))}else console.log("Empty array passed to processInstructions"),r="";return r},l=k.$watch(s.schema,function(e){if(e){var t=angular.isArray(e)?e:[e];if(0<t.length){l();var n="",r=s.model||"record",g=k[r];if(g=g||{},!s.subschema&&!s.model||s.forceform){k.topLevelFormName=s.name||"myForm";var a="";for(var o in s)s.hasOwnProperty(o)&&"$"!==o[0]&&-1===["name","formstyle","schema","subschema","model"].indexOf(o)&&(a+=" "+s.$attr[o]+'="'+s[o]+'"');n='<form name="'+k.topLevelFormName+'" class="'+m(s.formstyle)+' novalidate"'+a+">"}else n="";if(g===k.topLevelFormName)throw new Error("Model and Name must be distinct - they are both "+g);n+=F(t,!0,s),C===L.Forced&&(n+="</uib-tabset>"),n+=s.subschema?"":"</form>",x.replaceWith(c(n)(k));var i=k[s.shared||"sharedData"],b=i?i.modelControllers:[];if(0<w.length||0<b.length)var y=k.$watch("phase",function(e){if("ready"===e){y();for(var t=0;t<b.length;t++)b[t].onAllReady&&b[t].onAllReady(k);for(var n=0;n<w.length;n++){for(var r,a,o=w[n],i=angular.isArray(o.subkey)?o.subkey:[o.subkey],s=o.name.split("."),l=g;1<s.length;)l=l[s.shift()]||{};l=l[s[0]]=l[s[0]]||[];for(var c=0;c<i.length;c++){if(i[c].selectFunc){if(!k[i[c].selectFunc]||"function"!=typeof k[i[c].selectFunc])throw new Error("Subkey function "+i[c].selectFunc+" is not properly set up");r=k[i[c].selectFunc](g,o)}else{if(!i[c].keyList)throw new Error("Invalid subkey setup for "+o.name);var d=i[c].keyList;for(r=0;r<l.length;r++){for(var u in a=!0,d)if(d.hasOwnProperty(u)&&l[r][u]!==d[u]&&(void 0===l[r][u]||!l[r][u].text||l[r][u].text!==d[u])){a=!1;break}if(a)break}if(!a)switch(i[c].onNotFound){case"error":var f="Cannot find matching "+(i[c].title||i[c].path);E(function(){k.showError(f,"Unable to set up form correctly")}),r=-1;break;case"create":default:var p=o.name.split("."),m=p.pop(),h=p.join("."),v=g;h&&(v=v[h]),r=v[m].push(d)-1}}k["$_arrayOffset_"+o.name.replace(/\./g,"_")+"_"+c]=r}}}});d.$broadcast("formInputDone"),u.updateDataDependentDisplay&&g&&0<Object.keys(g).length&&u.updateDataDependentDisplay(g,null,!0,k)}}},!0)}}}n.$inject=["$compile","$rootScope","$filter","$timeout","cssFrameworkService","formGenerator","formMarkupHelper"],(t=L||(L={}))[t.Y=0]="Y",t[t.N=1]="N",t[t.Forced=2]="Forced",e.formInput=n}(e.directives||(e.directives={}))}(fng||(fng={})),function(e){(e.directives||(e.directives={})).fngNakedDate=function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,r){r.$parsers.push(function(e){if(e)return e.toString()}),r.$formatters.push(function(e){if(e)return new Date(e)})}}}}(fng||(fng={})),function(e){!function(e){function t(r,e,a,o){var t,n,i,s="";i=!1,n=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4)))&&(i=!0),t=!i,r.searchPlaceholder=t?"Ctrl + / to Search":"Search",r.handleKey=function(e){if(27===e.keyCode&&r.searchTarget&&0<r.searchTarget.length)r.searchTarget="";else if(0<r.results.length)switch(e.keyCode){case 38:0<r.focus&&r.setFocus(r.focus-1),"function"==typeof e.preventDefault&&e.preventDefault();break;case 40:r.results.length>r.focus+1&&r.setFocus(r.focus+1),"function"==typeof e.preventDefault&&e.preventDefault();break;case 13:null!=r.focus&&r.selectResult(r.focus)}},r.setFocus=function(e){null!==r.focus&&delete r.results[r.focus].focussed,r.results[e].focussed=!0,r.focus=e},r.selectResult=function(e){var t=r.results[e],n=o.prefix()+"/"+t.resource+"/"+t.id+"/edit";t.resourceTab&&(n+="/"+t.resourceTab),a.url(n)},r.resultClass=function(e){var t="search-result";return r.results&&r.results[e].focussed&&(t+=" focus"),t};var l=function(){r.moreCount=0,r.errorClass="",r.results=[],r.focus=null};r.$watch("searchTarget",function(n){n&&0<n.length?(s=n,e.get("/api/search?q="+n).then(function(e){var t=e.data;s===n&&(0<r.searchTarget.length?(r.results=t.results,r.moreCount=t.moreCount,0<t.results.length&&(r.errorClass="",r.setFocus(0)),r.errorClass=0===r.results.length?"error has-error":""):l())},function(e){console.log("Error in searchbox.js : "+e.data+" (status="+e.status+")")})):l()},!0),r.$on("$routeChangeStart",function(){r.searchTarget=""})}t.$inject=["$scope","$http","$location","routingService"],e.SearchCtrl=t}(e.controllers||(e.controllers={}))}(fng||(fng={})),function(n){!function(e){function t(e){return{restrict:"AE",templateUrl:"search-"+e.framework()+".html",controller:n.controllers.SearchCtrl}}t.$inject=["cssFrameworkService"],e.globalSearch=t}(n.directives||(n.directives={}))}(fng||(fng={})),function(e){(e.filters||(e.filters={})).camelCase=function(){return function(e){return e.replace(/([\:\-\_]+(.))/g,function(e,t,n,r){return r?n.toUpperCase():n})}}}(fng||(fng={})),function(e){(e.filters||(e.filters={})).titleCase=function(){return function(e,t){return e&&(e=e.replace(/(_|\.)/g," ").replace(/[A-Z]/g," $&").trim().replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}),e=t?e.replace(/\s/g,""):e.replace(/\s{2,}/g," ")),e}}}(fng||(fng={})),function(e){(e.services||(e.services={})).addAllService=function(){function r(e,t,r,n){var a,o,i=[],s=[];if(r="addAll"+r,"string"==typeof n)for(a=n.split(" "),o=0;o<a.length;o++)s.push(a[o]);if(function e(t){for(var n in t)n===r&&i.push(t[n]),"$parent"===n&&e(t[n])}(e),void 0!==t[r]&&"string"==typeof t[r])for(a=t[r].split(" "),o=0;o<a.length;o++)0===a[o].indexOf("class=")?s.push(a[o].substring(6,a[o].length)):i.push(a[o]);return(n=0<s.length?' class="'+s.join(" ")+'" ':" ")+(0<i.length?i.join(" ")+" ":"")}this.getAddAllGroupOptions=function(e,t,n){return r(e,t,"Group",n)},this.getAddAllFieldOptions=function(e,t,n){return r(e,t,"Field",n)},this.getAddAllLabelOptions=function(e,t,n){return r(e,t,"Label",n)},this.addAll=function(e,t,n,r){return this["getAddAll"+t+"Options"](e,r,n)||[]}}}(fng||(fng={})),function(e){(e.services||(e.services={})).cssFrameworkService=function(){var n={framework:"bs3"};return{setOptions:function(e){angular.extend(n,e)},$get:function(){return{framework:function(){return n.framework},setFrameworkForDemoWebsite:function(e){n.framework=e},span:function(e){var t;switch(n.framework){case"bs2":t="span"+Math.floor(e);break;case"bs3":t="col-xs-"+Math.floor(e)}return t},offset:function(e){var t;switch(n.framework){case"bs2":t="offset"+Math.floor(e);break;case"bs3":t="col-lg-offset-"+Math.floor(e)}return t},rowFluid:function(){var e;switch(n.framework){case"bs2":e="row-fluid";break;case"bs3":e="row"}return e}}}}}}(fng||(fng={})),function(n){!function(e){function t(c){return{loadControllerAndMenu:function(e,t,n,r,a){var o,i={};t+="Ctrl",i.$scope=e.modelControllers[n]=a;var s=a.$parent,l=function(e){angular.forEach(e,function(e){e.divider?r=!0:e[o]&&(r&&(r=!1,s.items.push({divider:!0})),s.items.push(e))})};try{c(t,i),o=s.newRecord?"creating":s.id?"editing":"listing",angular.isObject(i.$scope.contextMenu)&&(l(i.$scope.contextMenu),i.$scope.contextMenuPromise&&i.$scope.contextMenuPromise.then(function(e){return l(e)}))}catch(e){/is not a function, got undefined/.test(e.message)||/\[\$controller:ctrlreg\] The controller with the name/.test(e.message)||console.log("Unable to instantiate "+t+" - "+e.message)}}}}((n.services||(n.services={})).fngModelCtrlService=t).$inject=["$controller"]}()}(fng||(fng={})),function(e){!function(e){function t(n,t){var a,r,i={hashPrefix:"",html5Mode:!1,routing:"ngroute",prefix:""},s=["edit"],o=[{route:"/analyse/:model/:reportSchemaName",state:"analyse::model::report",templateUrl:"base-analysis.html"},{route:"/analyse/:model",state:"analyse::model",templateUrl:"base-analysis.html"},{route:"/:model/:id/edit",state:"model::edit",templateUrl:"base-edit.html"},{route:"/:model/:id/edit/:tab",state:"model::edit::tab",templateUrl:"base-edit.html"},{route:"/:model/new",state:"model::new",templateUrl:"base-edit.html"},{route:"/:model",state:"model::list",templateUrl:"base-list.html"},{route:"/:model/:form/:id/edit",state:"model::form::edit",templateUrl:"base-edit.html"},{route:"/:model/:form/:id/edit/:tab",state:"model::form::edit::tab",templateUrl:"base-edit.html"},{route:"/:model/:form/new",state:"model::form::new",templateUrl:"base-edit.html"},{route:"/:model/:form",state:"model::form::list",templateUrl:"base-list.html"}],l=null,c={};function d(e){var t=e;return i.templateFolder&&(t="/"!==i.templateFolder[i.templateFolder.length-1]?i.templateFolder+"/"+t:i.templateFolder+t),t}function u(e,n,r){void 0===n&&(n=""),n=n||"",angular.forEach(e,function(e){a.when(n+e.route,angular.extend(e.options||{templateUrl:d(e.templateUrl)},r))}),i.variantsForDemoWebsite&&angular.forEach(i.variantsForDemoWebsite,function(t){angular.forEach(e,function(e){a.when(n+t+e.route,angular.extend(e.options||{templateUrl:d(e.templateUrl)},r))})})}function f(e,t,n){void 0===t&&(t=""),t=t||"",angular.forEach(e,function(e){r.state(e.state,angular.extend(e.options||{url:t+e.route,templateUrl:e.templateUrl},n))})}function p(e,t,n,r,a,o){var i,s=r?"/"+r:"",l=e+"/"+n,c=o?"/"+o:"";switch(t){case"list":i=l+s;break;case"edit":i=l+s+"/"+a+"/edit"+c;break;case"new":i=l+s+"/new"+c}return i}function m(e,t){switch(i.routing){case"ngroute":a=n.get("$routeProvider"),e&&u(e),u(t,i.prefix,i.add2fngRoutes);break;case"uirouter":r=n.get("$stateProvider"),e&&f(i.fixedRoutes),f(t,i.prefix,i.add2fngRoutes)}}return{start:function(e){angular.extend(i,e),i.prefix[0]&&"/"!==i.prefix[0]&&(i.prefix="/"+i.prefix),t.html5Mode(i.html5Mode),""!==i.hashPrefix?t.hashPrefix(i.hashPrefix):i.html5Mode||t.hashPrefix(""),m(i.fixedRoutes,o)},addRoutes:function(e,t){m(e,t)},registerAction:function(e){s.push(e)},$get:function(){return{router:function(){return i.routing},prefix:function(){return i.prefix},parsePathFunc:function(){return function(e){if(e!==l){l=e,c={newRecord:!1},0<i.prefix.length&&0===e.indexOf(i.prefix)&&(e=e.slice(i.prefix.length));var t=e.split("/");i.variants&&-1!==i.variants.indexOf(t[1])&&(c.variant=t[1],t.shift());var n=t.length;if("analyse"===t[1])c.analyse=!0,c.modelName=t[2],c.reportSchemaName=4<=n?t[3]:null;else{c.modelName=t[1];var r=[t[n-1],t[n-2]],a=r.indexOf("new"),o=void 0;-1===a?-1!==(o=s.reduce(function(e,t){var n=r.indexOf(t);return-1<n?n:e},-1))&&(n-=2+o,c.id=t[n]):(c.newRecord=!0,n-=1+a),1!==o&&1!==a||(c.tab=r[0]),2<n&&(c.formName=t[2])}}return c}},buildUrl:function(e){var t=i.html5Mode?"":"#";return t+=i.hashPrefix,(t+=i.prefix)[0]&&(t+="/"),t+="/"===e[0]?e.slice(1):e},buildOperationUrl:function(e,t,n,r,a){return p(i.prefix,e,t,n,r,a)},redirectTo:function(){return function(e,t,n,r,a){n.search()&&n.url(n.path());var o=p(i.prefix,e,t.modelName,t.formName,r,a);n.path(o)}}}}}}t.$inject=["$injector","$locationProvider"],e.routingService=t}(e.services||(e.services={}))}(fng||(fng={})),function(n){!function(e){function t(e,t,o,n,r,i){function g(e,t,n,r,a,o,i,s){function l(e,t){var n=angular.copy(e),r=_.find(i.tabs,function(e){return e.title===n});if(!r){if(0===i.tabs.length&&0<i.formSchema.length){i.tabs.push({title:"Main",content:[],active:"Main"===i.tab||!i.tab}),r=i.tabs[0];for(var a=0;a<i.formSchema.length;a++)r.content.push(i.formSchema[a])}r=i.tabs[i.tabs.push({title:n,containerType:"tab",content:[],active:n===i.tab})-1]}r.content.push(t)}for(var c in t)if("_id"===c)r&&t._id.options&&t._id.options.list&&w(r,t._id.options.list,c);else if(t.hasOwnProperty(c)){var d=t[c],u=d.options||{},f=u.form||{};if(d.schema&&!f.hidden){if(o&&n){var p=[];g("Nested "+c,d.schema,p,null,c+".",!0,i,s);var m=y(c,f,a);m.schema=p,f.tab&&l(f.tab,m),void 0!==f.order?n.splice(f.order,0,m):n.push(m)}}else{if(n&&!f.hidden){var h=y(c,f,a);if(x(h.showIf,h.name,i)&&"options"!==c){var v=b(h,d,u,i,s);v.tab&&l(v.tab,v),void 0!==f.order?n.splice(f.order,0,v):n.push(v)}}r&&u.list&&w(r,u.list,c)}}r&&0===r.length&&k(e,r,n,t)}function b(t,e,n,r,a){if(e.caster&&(t.array=!0,e=e.caster,angular.extend(n,e.options),e.options&&e.options.form&&angular.extend(t,e.options.form)),"String"===e.instance)n.enum?(t.type=t.type||"select",t.select2?console.log("support for fng-select2 has been removed in 0.8.3 - please convert to fng-ui-select"):(t.options=i.suffixCleanId(t,"Options"),r[t.options]=n.enum)):(t.type||(t.type=-1!==t.name.toLowerCase().indexOf("password")?"password":"text"),n.match&&(t.add='pattern="'+n.match+'" '+(t.add||"")));else if("ObjectID"===e.instance)t.ref=n.ref,t.link&&t.link.linkOnly?(t.type="link",t.linkText=t.link.text,t.form=t.link.form,delete t.link):(t.type="select",t.select2||n.form&&n.form.select2?console.log("support for fng-select2 has been removed in 0.8.3 - please convert to fng-ui-select"):t.directive&&(t.noLookup||t[o("camelCase")(t.directive)]&&t[o("camelCase")(t.directive)].fngAjax)||function(){if(t.options=i.suffixCleanId(t,"Options"),t.ids=i.suffixCleanId(t,"_ids"),!t.hidden&&n.ref)switch("string"==typeof n.ref&&(n.ref={type:"lookup",collection:n.ref},console.warn('Support for string type "ref" property is deprecated - use ref:'+JSON.stringify(n.ref))),n.ref.type){case"lookup":i.setUpLookupOptions(n.ref.collection,t,r,a,g);break;case"lookupList":i.setUpLookupListOptions(n.ref,t,r,a);break;case"internal":i.handleInternalLookup(r,t,n.ref);break;default:throw new Error("Unsupported ref type "+n.ref.type+" found in "+t.name)}}());else if("Date"===e.instance){if(!t.type)if(t.readonly)t.type="text";else if(t.directive)t.type="text";else try{t.add=t.add||"";angular.module("ui.date").requires;t.type="text",t.add+=" ui-date ui-date-format "}catch(e){t.type="date",t.add+=' fng-naked-date="x" '}}else if("boolean"===e.instance.toLowerCase())t.type="checkbox";else{if("Number"!==e.instance)throw new Error("Field "+t.name+" is of unsupported type "+e.instance);t.type="number",void 0!==n.min&&(t.add='min="'+n.min+'" '+(t.add||"")),void 0!==n.max&&(t.add='max="'+n.max+'" '+(t.add||"")),t.step&&(t.add='step="'+t.step+'" '+(t.add||""))}return n.required&&(t.required=!0),n.readonly&&(t.readonly=!0),t}function a(e,t){for(var n=e.split("."),r=t.record,a=0,o=n.length;a<o;a++)r[n[a]]||(r[n[a]]=a===o-1?[]:{}),r=r[n[a]];return r}var y=function(e,t,n){return t.name=n+e,t},w=function(e,t,n){"object"==typeof t?(t.name=n,e.push(t)):e.push({name:n})},k=function(e,t,n,r){if(n){for(var a=0,o=n.length;a<o;a++)if("text"===n[a].type){t.push({name:n[a].name});break}0===t.length&&0!==n.length&&t.push({name:n[0].name})}if(0===t.length){for(var i in r)if("_id"!==i&&r.hasOwnProperty(i)){t.push({name:i});break}if(0===t.length)throw new Error("Unable to generate a title for "+e)}},v=function(e,r){function t(e){var t=e;if("string"==typeof e&&"$"===e.slice(0,1)){var n=e.split(".");switch(n.length){case 1:t=i.getListData(r,e.slice(1));break;case 2:t=i.getListData(r,n[1]);break;default:throw new Error("Unsupported showIf format")}}return t}var n,a=t(e.lhs),o=t(e.rhs);switch(e.comp){case"eq":n=a===o;break;case"ne":n=a!==o;break;default:throw new Error("Unsupported comparator "+e.comp)}return n},x=function(e,r,a){var o=0;function t(e){if("string"==typeof e&&"$"===e.slice(0,1)){var t=e.slice(1),n=a.dataDependencies[t]||[];n.push(r),a.dataDependencies[t]=n,o+=1}}var n=!0;return e&&(t(e.lhs),t(e.rhs),0!==o||v(e,void 0)||(n=!1)),n};return{generateEditUrl:function(e,t){return r.buildUrl(t.modelName+"/"+(t.formName?t.formName+"/":"")+e._id+"/edit")},generateNewUrl:function(e){return r.buildUrl(e.modelName+"/"+(e.formName?e.formName+"/":"")+"new")},handleFieldType:b,handleSchema:g,updateDataDependentDisplay:function(e,t,n,r){var a,o,i,s,l,c;for(var d in r.dataDependencies)if(r.dataDependencies.hasOwnProperty(d)){var u=d.split(".");if(1===u.length){if(n||!t||e[d]!==t[d])for(a=r.dataDependencies[d],o=0;o<a.length;o+=1){var f=a[o];for(i=0;i<r.formSchema.length;i+=1)r.formSchema[i].name===f&&(l=angular.element(document.querySelector("#cg_"+r.formSchema[i].id)),v(r.formSchema[i].showIf,e)?l.removeClass("ng-hide"):l.addClass("ng-hide"))}}else{if(2!==u.length)throw new Error("You can only go down one level of subdocument with showIf");if(void 0===c&&(c=!0),e[u[0]])for(s=0;s<e[u[0]].length;s++)if(n||!t||!t[u[0]]||!t[u[0]][s]||e[u[0]][s][u[1]]!==t[u[0]][s][u[1]])for(a=r.dataDependencies[d],o=0;o<a.length;o+=1){var p=a[o].split(".");if(2!==p.length)throw new Error("Conditional display must control dependent fields at same level ");for(i=0;i<r.formSchema.length;i+=1)if(r.formSchema[i].name===p[0])for(var m=r.formSchema[i].schema,h=0;h<m.length;h++)m[h].name===a[o]&&(0===(l=angular.element(document.querySelector("#f_"+p[0]+"List_"+s+" #cg_f_"+a[o].replace(".","_")))).length?l=angular.element(document.querySelector("#f_elements-"+s+"-"+p[1])):c=!1,0<l.length&&(v(r.formSchema[i].schema[h].showIf,e[u[0]][s])?l.show():l.hide()))}}}return c},add:function(e,t,n){t.target.offsetParent&&(a(e,n).push({}),n.setFormDirty(t))},unshift:function(e,t,n){a(e,n).unshift({}),n.setFormDirty(t)},remove:function(e,t,n,r){for(var a=e.split("."),o=r.record,i=0,s=a.length;i<s;i++)o=o[a[i]];o.splice(t,1),r.setFormDirty(n)},hasError:function(e,t,n,r){var a=!1;if(r){var o=r[r.topLevelFormName];if("null"!==e&&(o=o[e.replace("$index",n)]),o){var i=o[t];i&&i.$invalid&&!i.$$attr.readonly&&(i.$dirty?a=!0:angular.forEach(i.$validators,function(e,t){"required"!==t&&i.$error[t]&&(a=!0)}))}}else console.log("hasError called with no scope! ",e,t,n);return a},decorateScope:function(r,a,n,e){r.record=e.record,r.phase="init",r.disableFunctions=e.disableFunctions,r.dataEventFunctions=e.dataEventFunctions,r.topLevelFormName=void 0,r.formSchema=[],r.tabs=[],r.listSchema=[],r.recordList=[],r.dataDependencies={},r.internalLookups=[],r.listLookups=[],r.conversions={},r.pageSize=60,r.pagesLoaded=0,(e.baseScope=r).generateEditUrl=function(e){return a.generateEditUrl(e,r)},r.generateNewUrl=function(){return a.generateNewUrl(r)},r.scrollTheList=function(){return n.scrollTheList(r)},r.getListData=function(e,t){return n.getListData(r,e,t,r.listSchema)},r.setPristine=function(e){e&&r.dismissError(),r[r.topLevelFormName]&&r[r.topLevelFormName].$setPristine()},r.skipCols=function(e){return 0<e?"col-md-offset-3":""},r.setFormDirty=function(e){e?angular.element(e.target).inheritedData("$formController").$setDirty():console.log("setFormDirty called without an event (fine in a unit test)")},r.add=function(e,t){return a.add(e,t,r)},r.hasError=function(e,t,n){return a.hasError(e,t,n,r)},r.unshift=function(e,t){return a.unshift(e,t,r)},r.remove=function(e,t,n){return a.remove(e,t,n,r)},r.baseSchema=function(){return r.tabs.length?r.tabs:r.formSchema}}}}((n.services||(n.services={})).formGenerator=t).$inject=["$location","$timeout","$filter","SubmissionsService","routingService","recordHandler"]}()}(fng||(fng={})),function(e){!function(e){function t(f,p,m){var d=function(e){return!e||"undefined"===e||-1===["vertical","inline"].indexOf(e)};function i(){return"bs2"===f.framework()?"icon":"glyphicon glyphicon"}return{isHorizontalStyle:d,fieldChrome:function(e,t,n){var r=t.classes||"",a="",o="",i="";if(t.showWhen=t.showWhen||t.showwhen,t.showWhen&&("string"==typeof t.showWhen?i+='ng-show="'+t.showWhen+'"':i+='ng-show="'+function(e,a){function t(e){var t=e;if("string"==typeof e)if("$"===e.slice(0,1)){t=(a||"record")+".";var n=e.slice(1).split(".");if(1<n.length){var r=n.pop();t+=n.join(".")+"[$index]."+r}else t+=e.slice(1)}else t="'"+e+"'";return t}var n=["eq","ne","gt","gte","lt","lte"].indexOf(e.comp);if(-1===n)throw new Error("Invalid comparison in showWhen");return t(e.lhs)+["===","!==",">",">=","<","<="][n]+t(e.rhs)}(t.showWhen,n.model)+'"'),i+=' id="cg_'+t.id.replace(/\./g,"-")+'"',"bs3"===f.framework()){var s;r+=" form-group","vertical"===n.formstyle&&"block-level"!==t.size&&(a+='<div class="row">',r+=" col-sm-"+p.sizeAsNumber(t.size),o+="</div>");var l=null,c=t.name.split(".");n&&void 0!==n.subkeyno?s=n.subschemaroot.replace(/\./g,"-")+"-subkey"+n.subkeyno+"-"+c[c.length-1]:n.subschema?(l="form_"+c.slice(0,-1).join("_")+"$index",s=t.name.replace(/\./g,"-")):s="f_"+t.name.replace(/\./g,"_"),a+="<div"+m.addAll(e,"Group",r,n)+" ng-class=\"{'has-error': hasError('"+l+"','"+s+"', $index)}\"",o+="</div>"}else d(n.formstyle)?(a+="<div"+m.addAll(e,"Group","control-group",n),o="</div>"):(a+="<span ",o="</span>");return{template:a+=(i||"")+">",closeTag:o}},label:function(e,t,n,r){var a="";if("bs3"===f.framework()||"inline"!==r.formstyle&&""!==t.label||n){a="<label";var o="control-label";d(r.formstyle)?(a+=' for="'+t.id+'"',void 0!==t.labelDefaultClass?o+=" "+t.labelDefaultClass:"bs3"===f.framework()&&(o+=" col-sm-3")):"inline"===r.formstyle&&(a+=' for="'+t.id+'"',o+=" sr-only"),a+=m.addAll(e,"Label",null,r)+' class="'+o+'">'+t.label,n&&(a+=' <i id="add_'+t.id+'" ng-click="add(\''+t.name+'\',$event)" class="'+i()+'-plus-sign"></i>'),a+="</label>"}return a},glyphClass:i,allInputsVars:function(e,t,n,r,a,o){var i,s=t.placeHolder,l="",c="",d="",u="";return"bs3"===f.framework()?(l=-1===["horizontal","vertical","inline"].indexOf(n.formstyle)?" input-sm":"",c="col-sm-"+p.sizeAsNumber(t.size),u=" form-control"):d=t.size?" input-"+t.size:"","inline"===n.formstyle&&(s=s||t.label),i='ng-model="'+r+'"'+(a?' id="'+a+'" name="'+a+'" ':' name="'+o+'" '),i+=s?'placeholder="'+s+'" ':"",t.popup&&(i+='title="'+t.popup+'" '),{common:i+=m.addAll(e,"Field",null,n),sizeClassBS3:c,sizeClassBS2:d,compactClass:l,formControl:u}},inputChrome:function(e,t,n,r){"bs3"===f.framework()&&d(n.formstyle)&&"checkbox"!==t.type&&(e='<div class="bs3-input '+r.sizeClassBS3+'">'+e+"</div>");var a=(t.helpInline||"")+(t.helpinline||"");return 0<a.length&&(e+='<span class="'+("bs2"===f.framework()?"help-inline":"help-block")+'">'+a+"</span>"),e+='<div ng-if="'+(n.name||"myForm")+"."+t.id+'.$dirty" class="help-block"> <div ng-messages="'+(n.name||"myForm")+"."+t.id+'.$error">  <div ng-messages-include="error-messages.html">  </div> </div></div>',t.help&&(e+='<span class="help-block">'+t.help+"</span>"),e},generateSimpleInput:function(e,t,n){var r="<input "+e+'type="'+t.type+'"';return"inline"!==n.formstyle||"bs2"!==f.framework()||t.size||(r+='class="input-small"'),r+=" />"},controlDivClasses:function(e){var t=[];return d(e.formstyle)&&t.push("bs2"===f.framework()?"controls":"col-sm-9"),t},handleInputAndControlDiv:function(e,t){return 0<t.length&&(e='<div class="'+t.join(" ")+'">'+e+"</div>"),e},handleArrayInputAndControlDiv:function(e,t,n,r){var a="<div ";return"bs3"===f.framework()&&(a+='ng-class="skipCols($index)" '),a+='class="'+t.join(" ")+'" id="'+n.id+'List" ',a+='ng-repeat="arrayItem in '+(r.model||"record")+"."+n.name+' track by $index">',a+=e,"link"!==n.type&&(a+="<i ng-click=\"remove('"+n.name+'\',$index,$event)" id="remove_'+n.id+'_{{$index}}" class="'+i()+'-minus-sign"></i>'),a+="</div>"},addTextInputMarkup:function(e,t,n){var r="",a=e.formControl.trim()+e.compactClass+e.sizeClassBS2+(t.class?" "+t.class:"");return 0!==a.length&&(r+='class="'+a+'"'),t.add&&(r+=" "+t.add+" "),r+=n+(t.readonly?" readonly":"")+" "}}}t.$inject=["cssFrameworkService","inputSizeHelper","addAllService"],e.formMarkupHelper=t}(e.services||(e.services={}))}(fng||(fng={})),function(e){(e.services||(e.services={})).inputSizeHelper=function(){var t=[1,2,4,6,8,10,12],n=["mini","small","medium","large","xlarge","xxlarge","block-level"];return{sizeMapping:t,sizeDescriptions:n,defaultSizeOffset:2,sizeAsNumber:function(e){return t[e?n.indexOf(e):2]}}}}(fng||(fng={})),function(e){!function(e){function t(b){return{extractFromAttr:function(e,t){function n(e){var t=e.replace(/&quot;/g,'"');return"true"===t?t=!0:"false"===t?t=!1:!isNaN(parseFloat(t))&&isFinite(t)&&(t=parseFloat(t)),t}var r={},a={formStyle:e.formstyle},o={},i=t?t.length:0;for(var s in e)e.hasOwnProperty(s)&&("fngFld"===s.slice(0,6)?r[s.slice(6).toLowerCase()]=n(e[s]):"fngOpt"===s.slice(0,6)?a[s.slice(6).toLowerCase()]=n(e[s]):t&&s.slice(0,i)===t&&(o[_.kebabCase(s.slice(i))]=n(e[s])));return{info:r,options:a,directiveOptions:o}},buildInputMarkup:function(e,t,n,r,a,o,i){var s,l,c,d=b.fieldChrome(e,n,r,' id="cg_'+n.id+'"'),u=b.controlDivClasses(r),f=d.template+b.label(e,n,a,r);if(a?(s="arrayItem"+(o?".x":""),l=n.id+"_{{$index}}",c=n.name+"_{{$index}}"):(s=t+"."+n.name,l=n.id,c=n.name),r.subschema&&-1!==n.name.indexOf(".")){var p=t+".",m=n.name,h=r.subschemaroot,v=m.slice(h.length+1);s=p,r.index?l="f_"+(s+=h+"["+r.index+"]."+v).slice(p.length).replace(/(\.|\[|\]\.)/g,"-"):(s+=h,r.subkey?(l=s.slice(p.length).replace(/\./g,"-")+"-subkey"+r.subkeyno+"-"+v,s+="[$_arrayOffset_"+h.replace(/\./g,"_")+"_"+r.subkeyno+"]."+v):(s+="[$index]."+v,l=null,c=m.replace(/\./g,"-")))}var g=b.allInputsVars(e,n,r,s,l,c);return g.modelString=s,f+=b["handle"+(a?"Array":"")+"InputAndControlDiv"](b.inputChrome(i(g),n,r,g),u,n,r),f+=d.closeTag},findIdInSchemaAndFlagNeedX:function e(t,n){for(var r=!1,a=0;a<t.length;a++){var o=t[a];if(o.id===n){r=o.needsX=!0;break}if(o.schema&&e(o.schema,n)){r=!0;break}}return r}}}t.$inject=["formMarkupHelper"],e.pluginHelper=t}(e.services||(e.services={}))}(fng||(fng={})),function(e){!function(e){function t(e,l,i,a,t,s,p,o){var c=function(e){return void 0===e&&(e=function(e){return Math.floor(e).toString(16)}),e(Date.now()/1e3)+" ".repeat(16).replace(/./g,function(){return e(16*Math.random())})},b=function(e,t){return(e.id||"f_"+e.name).replace(/\./g,"_")+t},d=function(e,t,n,r){void 0===r&&(r=!1);for(var a=t.split("."),o=a.length-1,i=e,s=0;s<o;s++){if(!i)throw new Error("walkTree failed: Object = "+e+", fieldname = "+t+", i = "+s);if(angular.isArray(i)?i=_.map(i,function(e){return e[a[s]]}):(r&&!i[a[s]]&&(i[a[s]]={}),i=i[a[s]]),angular.isArray(i)&&void 0!==n)if(n.scope&&"function"==typeof n.scope)i=i[n.scope().$index];else{if("number"!=typeof n)throw new Error("Unsupported element type in walkTree "+t);i=i[n]}if(!i)break}return{lastObject:i,key:i?a[o]:void 0}},y=function(e,t,n,r){var a=d(e,t,n,!0);if(a.lastObject&&a.key)if(angular.isArray(a.lastObject))for(var o=0;o<a.lastObject.length;o++)a.lastObject[o][a.key]=r[o];else a.lastObject[a.key]=r},w=function(e,t,n){var r,a=d(e,t,n);return a.lastObject&&a.key&&(r=angular.isArray(a.lastObject)?_.map(a.lastObject,function(e){return e[a.key]}):a.lastObject[a.key]),r},m=function(t,n,e){if(!n.topLevelFormName||n[n.topLevelFormName].$pristine){x(t.name,e.master,function(e){return S(t,e,n[b(t,"Options")],n[b(t,"_ids")])});var r=w(e.master,t.name);r&&y(n.record,t.name,void 0,r)}};var k=function(e,t,n,r){void 0===r&&(r=null);var a=w(t,n)||"";if(a&&r){var o=_.find(r,function(e){return e.name===n});if(o)switch(o.params){case void 0:break;case"timestamp":var i=a.toString().substring(0,8),s=new Date(1e3*parseInt(i,16));a=s.toLocaleDateString()+" "+s.toLocaleTimeString();break;default:a=e.dataEventFunctions[o.params](t)}}return a};function x(e,t,n){var r,a,o=(r=e.split("."),a=[r[0]],1<r.length&&a.push(r.slice(1).join(".")),a);if(1<o.length)!function(e,t,n){if(void 0!==t)if(angular.isArray(t))for(var r=0;r<t.length;r++)x(e,t[r],n);else x(e,t,n)}(o[1],t[o[0]],n);else if(t[o[0]]){var i=t[o[0]];if(angular.isArray(i))for(var s=i.length-1;0<=s;s--){var l=typeof i[s];("undefined"===l||"object"===l&&0===Object.keys(i[s]).length)&&i.splice(s,1)}t[o[0]]=n(i)}}function v(e,t,n,r,a){var o="string"==typeof t?e[t]:t,i="string"==typeof n?e[n]:n;o.length=0,i.length=0,r&&0<r.length&&r.forEach(function(e){var t=e[a];t&&0<t.length&&(o.push(t),e._id||(e._id=c()),i.push(e._id))})}var C=function(e){var t=!1;return e.needsX?t=!0:e.directive||("text"===e.type?t=!0:"select"!==e.type||e.ids||(t=!0)),t};function $(e,t,n){var r=e.conversions;return n&&(r=w(r,n)||{}),r[t]}var g=function(e,t,n,r,a,o,i){o=o||t;for(var s=0;s<e.length;s++){var l=e[s],c=l.name.slice(n),d=w(t,c);if(l.schema){if(d)for(var u=0;u<d.length;u++)d[u]=g(l.schema,d[u],n+1+c.length,r,c,o,u)}else{l.ref&&"internal"===l.ref.type&&v(r,l.options,l.ids,o[l.ref.property],l.ref.value);var f=k(r,t,c);if(l.array&&C(l)&&f)for(var p=0;p<f.length;p++)f[p]={x:f[p]};var m=r[b(l,"_ids")],h=void 0;if(d&&m&&0<m.length){if(-1!==c.indexOf("."))throw new Error("Trying to directly assign to a nested field 332");t[c]=S(l,d,r[b(l,"Options")],m)}else l.select2?(console.log("fng-select2 is deprecated - use fng-ui-select instead"),l.select2):d&&(h=$(r,c,a))&&h.fngajax&&!h.noconvert&&h.fngajax(d,l,function(e,t){y(o,e.name,i,t),F(angular.element("#"+e.id),function(){y(r.record,e.name,i,t)})})}}return t};function S(e,t,n,r){if(e.array){for(var a=[],o=!e.directive||C(e),i=0;i<t.length;i++){var s=t[i];s&&s.x&&(s=s.x);var l=u(s,r,n,e.name);o&&(l={x:l}),a.push(l)}return a}return e.select2?{id:t,text:u(t,r,n,e.name)}:u(t,r,n,e.name)}var D=function(e,t,n,r){var a=_.isObject(e)?e.x||e.text:e;if(a&&a.match(/^[0-9a-f]{24}$/))return a;var o=t.indexOf(a);if(-1===o)throw new Error("convertListValueToId: Invalid data - value "+a+" not found in "+t+" processing "+r);return n[o]},F=function(e,t){var n=e.inheritedData("$ngModelController"),r=n&&n.$pristine;r&&(n.$pristine=!1),t(),r&&(n.$pristine=!0)},u=function(e,t,n,r){"object"==typeof e&&(e=e.id);var a=t.indexOf(e);if(-1===a)throw new Error("convertIdToListValue: Invalid data - id "+e+" not found in "+t+" processing "+r);return n[a]},f=function(e,t,n){n.master=g(t.formSchema,e,0,t),t.phase="ready",t.cancel()};function h(t,n,r,e,a){if(a&&0<a.length&&a.length===e.length&&n[r]){var o=a.findIndex(function(e){return e[t.value]===n[r]});if(-1<o){var i=e[o][t.value];i&&(n[r]=i)}}}function N(e,c,n,t,d){var r=!c.id&&!c.newRecord;function a(o,i){c.internalLookups.forEach(function(n){var r=o[n.ref.property],a=i[n.ref.property];v(c,n.lookupOptions,n.lookupIds,r,n.ref.value),(r&&0<r.length||a&&0<a.length)&&n.handlers.forEach(function(t){if(t.possibleArray){var e=w(c.record,t.possibleArray,null);e&&0<e.length&&e.forEach(function(e){return h(n.ref,e,t.lastPart,r,a)})}else angular.isArray(c.record[t.lastPart])?c.record[t.lastPart].forEach(function(e){h(n.ref,e,"x",r,a)}):h(n.ref,c.record,t.lastPart,r,a)})}),c.listLookups.forEach(function(l){function e(e,t){var n=e[t];return n&&n.id&&(n=n.id),n}var t=l.ref.id.slice(1);if(t.includes("."))throw new Error("No support for nested list lookups yet - "+JSON.stringify(l.ref));var n=e(o,t);n!==e(i,t)&&(n?p.readRecord(l.ref.collection,n).then(function(s){l.handlers.forEach(function(e){for(var t=c[e.formInstructions.options],n=c[e.formInstructions.ids],r=s.data[l.ref.property]||[],a=0;a<r.length;a++){var o=r[a][l.ref.value],i=_.sortedIndex(t,o);t[i]===o&&(o=o+"    ("+r[a]._id+")",i=_.sortedIndex(t,o)),t.splice(i,0,o),n.splice(i,0,r[a]._id)}m(e.formInstructions,c,d)})}):l.handlers.forEach(function(e){c[e.formInstructions.options].length=0,c[e.formInstructions.ids].length=0,m(e.formInstructions,c,d)}))})}function o(){c.phase="ready",c.cancel(),a(c.record,{})}if(n.handleSchema("Main "+c.modelName,e,r?null:c.formSchema,c.listSchema,"",!0,c,d),r)d.allowLocationChange=!0;else{var i=!0;if(c.newRecord||(c.dropConversionWatcher=c.$watchCollection("conversions",function(e,t){e!==t&&c.originalData&&f(c.originalData,c,d)})),c.$watch("record",function(e,t){e!==t&&(0<Object.keys(t).length&&c.dropConversionWatcher&&(c.dropConversionWatcher(),c.dropConversionWatcher=null),i=n.updateDataDependentDisplay(e,t,i,c),a(e,t))},!0),c.id)"function"==typeof c.dataEventFunctions.onBeforeRead?c.dataEventFunctions.onBeforeRead(c.id,function(e){e?c.showError(e):t.readRecord(c,d)}):t.readRecord(c,d);else{d.allowLocationChange=!1,d.master={};var s=c.initialiseNewRecord||l.$$search.r;if(s)try{d.master=JSON.parse(s),c.$on("fngCancel",function(){setTimeout(function(){c[c.topLevelFormName]&&c[c.topLevelFormName].$setDirty()},2)})}catch(e){console.log("Error parsing specified record : "+e.message)}"function"==typeof c.dataEventFunctions.onInitialiseNewRecord&&(console.log("onInitialiseNewRecord is deprecated - use the async version - onNewRecordInit(data,cb)"),c.dataEventFunctions.onInitialiseNewRecord(d.master)),"function"==typeof c.dataEventFunctions.onNewRecordInit?c.dataEventFunctions.onNewRecordInit(d.master,function(e){e?c.showError(e):o()}):o()}}}function E(r){return function(e){if(-1!==[200,400].indexOf(e.status)){var t="";for(var n in e.data.errors)if(e.data.errors.hasOwnProperty(n)){switch(t+="<li><b>"+a("titleCase")(n)+": </b> ",e.data.errors[n].type){case"enum":t+="You need to select from the list of values";break;default:t+=e.data.errors[n].message}t+="</li>"}t=0<t.length?e.data.message+"<br /><ul>"+t+"</ul>":e.data.message||"Error!  Sorry - No further details available.",r.showError(t)}else r.showError(e.status+" "+JSON.stringify(e.data))}}function A(e,t,n){n.allowLocationChange=!1,t.phase="reading","function"==typeof t.dataEventFunctions.onAfterRead&&t.dataEventFunctions.onAfterRead(e),t.originalData=e,f(e,t,n)}return{readRecord:function(n,r){p.readRecord(n.modelName,n.id).then(function(e){var t=e.data;!1===t.success?l.path("/404"):A(t,n,r)},n.handleHttpError)},scrollTheList:function(n){var r=n.pagesLoaded;p.getPagedAndFilteredList(n.modelName,{aggregate:l.$$search.a,find:l.$$search.f,limit:n.pageSize,skip:r*n.pageSize,order:l.$$search.o}).then(function(e){var t=e.data;angular.isArray(t)?r===n.pagesLoaded?(n.pagesLoaded++,n.recordList=n.recordList.concat(t)):console.log("DEBUG: infinite scroll component asked for a page twice - the model was "+n.modelName):n.showError(t,"Invalid query")},n.handleHttpError)},deleteRecord:function(e,t,n,r){p.deleteRecord(e,t).then(function(){"function"==typeof n.dataEventFunctions.onAfterDelete&&n.dataEventFunctions.onAfterDelete(r.master),s.redirectTo()("list",n,l)})},updateDocument:function(e,n,r,a){r.phase="updating",p.updateRecord(r.modelName,r.id,e).then(function(e){var t=e.data;!1!==t.success?("function"==typeof r.dataEventFunctions.onAfterUpdate&&r.dataEventFunctions.onAfterUpdate(t,a.master),n.redirect?(n.allowChange&&(a.allowLocationChange=!0),i.location=n.redirect):(A(t,r,a),r.setPristine(!1))):r.showError(t)},r.handleHttpError)},createNew:function(e,n,r,a){p.createRecord(r.modelName,e).then(function(e){var t=e.data;!1!==t.success?(a.allowLocationChange=!0,"function"==typeof r.dataEventFunctions.onAfterCreate&&r.dataEventFunctions.onAfterCreate(t),n.redirect?i.location=n.redirect:s.redirectTo()("edit",r,l,t._id)):r.showError(t)},r.handleHttpError)},getListData:k,suffixCleanId:b,setData:y,setUpLookupOptions:function(n,l,c,d,r){var u=c[l.options]=[],f=c[l.ids]=[];o.getSchema(n).then(function(e){var t=e.data,s=[];r("Lookup "+n,t,null,s,"",!1,c,d),(void 0!==l.filter&&l.filter?p.getPagedAndFilteredList(n,l.filter):p.getAll(n)).then(function(e){var t=e.data;if(t){for(var n=0;n<t.length;n++){for(var r="",a=0;a<s.length;a++){var o=t[n][s[a].name];r+=o?o+" ":""}r=r.trim();var i=_.sortedIndex(u,r);u[i]===r&&(r=r+"    ("+t[n]._id+")",i=_.sortedIndex(u,r)),u.splice(i,0,r),f.splice(i,0,t[n]._id)}m(l,c,d)}})})},setUpLookupListOptions:function(o,i,s,l){var c=s[i.options]=[],d=s[i.ids]=[];if("$"===o.id[0]){var e=i.name.split("."),t=s.listLookups.find(function(e){return e.ref.property===o.property&&e.ref.value===o.value}),n={formInstructions:i,lastPart:e.pop(),possibleArray:e.join(".")};t||(t={ref:o,lookupOptions:[],lookupIds:[],handlers:[]},s.listLookups.push(t)),t.handlers.push(n),s[i.options]=t.lookupOptions,s[i.ids]=t.lookupIds}else p.readRecord(o.collection,s.$eval(o.id)).then(function(e){for(var t=e.data[o.property],n=0;n<t.length;n++){var r=t[n][o.value],a=_.sortedIndex(c,r);c[a]===r&&(r=r+"    ("+t[n]._id+")",a=_.sortedIndex(c,r)),c.splice(a,0,r),d.splice(a,0,t[n]._id)}m(i,s,l)})},handleInternalLookup:function(e,t,n){var r=t.name.split("."),a=e.internalLookups.find(function(e){return e.ref.property===n.property&&e.ref.value===n.value}),o={formInstructions:t,lastPart:r.pop(),possibleArray:r.join(".")};a||(a={ref:n,lookupOptions:[],lookupIds:[],handlers:[]},e.internalLookups.push(a)),a.handlers.push(o),e[t.options]=a.lookupOptions,e[t.ids]=a.lookupIds},preservePristine:F,convertToMongoModel:function d(u,f,p,m,h){function v(e,t){var n;return t&&t.fngajax?e&&(n=e.id||e):e&&(n=e.text||(e.x?e.x.text:e)),n}for(var e=function(){var t=u[g],e=t.name.slice(p),n=k(m,f,e);if(t.schema){if(n)for(var r=0;r<n.length;r++)n[r]=d(t.schema,n[r],p+1+e.length,m,e)}else{if(t.array&&C(t)&&n)for(var a=0;a<n.length;a++)n[a]=n[a].x;var o=m[b(t,"_ids")],i=void 0;if(o&&0<o.length)x(e,f,function(e){return function(e,t,n,r){if(e.array){for(var a=[],o=0;o<t.length;o++)a.push(D(t[o],n,r,e.name));return a}return D(t,n,r,e.name)}(t,e,m[b(t,"Options")],o)});else if(i=$(m,e,h)){var s=w(f,e,null),l=void 0;if(t.array){if(l=[],s)for(var c=0;c<s.length;c++)l[c]=v(s[c],i)}else l=v(s,i);y(f,e,null,l)}}},g=0;g<u.length;g++)e();return f},convertIdToListValue:u,handleError:E,decorateScope:function(r,n,a,o){r.handleHttpError=E(r),r.cancel=function(){angular.copy(o.master,r.record),r.$broadcast("fngCancel",r),t(r.setPristine)},r.$on("showErrorMessage",function(e,t){r.showError(t.body,t.title)}),r.showError=function(t,e){if(r.alertTitle=e||"Error!","string"==typeof t)r.errorMessage=t;else if(t.message&&"string"==typeof t.message)r.errorMessage=t.message;else if(t.data&&t.data.message)r.errorMessage=t.data.message;else try{r.errorMessage=JSON.stringify(t)}catch(e){r.errorMessage=t}},r.dismissError=function(){delete r.errorMessage,delete r.alertTitle},r.prepareForSave=function(t){var n=a.convertToMongoModel(r.formSchema,angular.copy(r.record),0,r);r.id?"function"==typeof r.dataEventFunctions.onBeforeUpdate?r.dataEventFunctions.onBeforeUpdate(n,o.master,function(e){e?t(e):t(null,n)}):t(null,n):"function"==typeof r.dataEventFunctions.onBeforeCreate?r.dataEventFunctions.onBeforeCreate(n,function(e){e?t(e):t(null,n)}):t(null,n)},r.save=function(n){n=n||{},r.prepareForSave(function(e,t){e?"_update_handled_"!==e&&r.showError(e):r.id?a.updateDocument(t,n,r,o):a.createNew(t,n,r,o)})},r.newClick=function(){s.redirectTo()("new",r,l)},r.$on("$locationChangeStart",function(e,t){o.allowLocationChange||r.isCancelDisabled()||(e.preventDefault(),n.open({template:'<div class="modal-header">   <h3>Record modified</h3></div><div class="modal-body">   <p>Would you like to save your changes?</p></div><div class="modal-footer">    <button class="btn btn-primary dlg-yes" ng-click="yes()">Yes</button>    <button class="btn btn-warning dlg-no" ng-click="no()">No</button>    <button class="btn dlg-cancel" ng-click="cancel()">Cancel</button></div>',controller:"SaveChangesModalCtrl",backdrop:"static"}).result.then(function(e){e?r.save({redirect:t,allowChange:!0}):(o.allowLocationChange=!0,i.location=t)}))}),r.deleteClick=function(){if(r.record._id){var e=void 0;if(r.unconfirmedDelete)e=Promise.resolve(!0);else e=n.open({template:'<div class="modal-header">   <h3>Delete Item</h3></div><div class="modal-body">   <p>Are you sure you want to delete this record?</p></div><div class="modal-footer">    <button class="btn btn-primary dlg-no" ng-click="cancel()">No</button>    <button class="btn btn-warning dlg-yes" ng-click="yes()">Yes</button></div>',controller:"SaveChangesModalCtrl",backdrop:"static"}).result;e.then(function(e){e&&("function"==typeof r.dataEventFunctions.onBeforeDelete?r.dataEventFunctions.onBeforeDelete(o.master,function(e){e?"_delete_handled_"!==e&&r.showError(e):a.deleteRecord(r.modelName,r.id,r,o)}):a.deleteRecord(r.modelName,r.id,r,o))})}},r.isCancelDisabled=function(){return"function"==typeof r.disableFunctions.isCancelDisabled?r.disableFunctions.isCancelDisabled(r.record,o.master,r[r.topLevelFormName]):r[r.topLevelFormName]&&r[r.topLevelFormName].$pristine},r.isSaveDisabled=function(){return"function"==typeof r.disableFunctions.isSaveDisabled?r.disableFunctions.isSaveDisabled(r.record,o.master,r[r.topLevelFormName]):r[r.topLevelFormName]&&(r[r.topLevelFormName].$invalid||r[r.topLevelFormName].$pristine)},r.isDeleteDisabled=function(){return"function"==typeof r.disableFunctions.isDeleteDisabled?r.disableFunctions.isDeleteDisabled(r.record,o.master,r[r.topLevelFormName]):!r.id},r.isNewDisabled=function(){return"function"==typeof r.disableFunctions.isNewDisabled&&r.disableFunctions.isNewDisabled(r.record,o.master,r[r.topLevelFormName])},r.disabledText=function(e){var t="";return r.isSaveDisabled&&(t="This button is only enabled when the form is complete and valid.  Make sure all required inputs are filled in. "+e),t},r.getVal=function(e,t){if(-1===e.indexOf("$index")||void 0!==t)return e=e.replace(/\$index/g,t),r.$eval("record."+e)},r.sortableOptions={update:function(){r.topLevelFormName&&r[r.topLevelFormName].$setDirty()}}},fillFormFromBackendCustomSchema:N,fillFormWithBackendSchema:function(t,n,r,a){o.getSchema(t.modelName,t.formName).then(function(e){N(e.data,t,n,r,a)},t.handleHttpError)}}}t.$inject=["$http","$location","$window","$filter","$timeout","routingService","SubmissionsService","SchemasService"],e.recordHandler=t}(e.services||(e.services={}))}(fng||(fng={})),function(e){!function(e){function t(n){return{getSchema:function(e,t){return n.get("/api/schema/"+e+(t?"/"+t:""),{cache:!0})}}}t.$inject=["$http"],e.SchemasService=t}(e.services||(e.services={}))}(fng||(fng={})),function(e){!function(e){function t(o,r){return{getListAttributes:function(e,t){return"string"==typeof e&&(e={type:"lookup",collection:e},console.warn('Support for string type "ref" property is deprecated - use ref:'+JSON.stringify(e))),o.get("/api/"+e.collection+"/"+t+"/list")},readRecord:function(e,t){return o.get("/api/"+e+"/"+t)},getAll:function(e,t){var n=angular.extend({cache:!0},t);return o.get("/api/"+e,n)},getPagedAndFilteredList:function(e,t){return o.get("/api/"+e+(r="",(a=function(e,t){void 0!==t&&""!==t&&("object"==typeof t&&(t=JSON.stringify(t)),""===r?r="?":r+="&",r+=e+"="+t)})("l",(n=t).limit),a("f",n.find),a("a",n.aggregate),a("o",n.order),a("s",n.skip),r));var n,r,a},deleteRecord:function(e,t){return o.delete("/api/"+e+"/"+t)},updateRecord:function(e,t,n){return r.get("$http").remove("/api/"+e),o.post("/api/"+e+"/"+t,n)},createRecord:function(e,t){return r.get("$http").remove("/api/"+e),o.post("/api/"+e,t)}}}t.$inject=["$http","$cacheFactory"],e.SubmissionsService=t}(e.services||(e.services={}))}(fng||(fng={})),function(e){!function(e){function t(e,t,n,r,a,o,i,s,l){e.sharedData={record:{},disableFunctions:{},dataEventFunctions:{},modelControllers:[]};var c={master:{},fngInvalidRequired:"fng-invalid-required",allowLocationChange:!0};angular.extend(e,i.parsePathFunc()(n.$$path));var d=r("titleCase")(e.modelName,!0);o.loadControllerAndMenu(e.sharedData,d,0,!1,e.$new()),e.formName&&o.loadControllerAndMenu(e.sharedData,d+r("titleCase")(e.formName,!0),1,!1,e.$new()),t.$broadcast("fngControllersLoaded",e.sharedData,e.modelName),e.modelNameDisplay=e.sharedData.modelNameDisplay||r("titleCase")(e.modelName),t.$broadcast("fngFormLoadStart",e),s.decorateScope(e,s,l,e.sharedData),l.decorateScope(e,a,l,c),l.fillFormWithBackendSchema(e,s,l,c);for(var u=0;u<e.sharedData.modelControllers.length;u++)e.sharedData.modelControllers[u].onBaseCtrlReady&&e.sharedData.modelControllers[u].onBaseCtrlReady(e);e.$on("$destroy",function(){e.sharedData.modelControllers.forEach(function(e){return e.$destroy()}),t.$broadcast("fngControllersUnloaded")})}t.$inject=["$scope","$rootScope","$location","$filter","$uibModal","fngModelCtrlService","routingService","formGenerator","recordHandler"],e.BaseCtrl=t}(e.controllers||(e.controllers={}))}(fng||(fng={})),function(e){!function(e){function t(e,t){e.yes=function(){t.close(!0)},e.no=function(){t.close(!1)},e.cancel=function(){t.dismiss("cancel")}}t.$inject=["$scope","$uibModalInstance"],e.SaveChangesModalCtrl=t}(e.controllers||(e.controllers={}))}(fng||(fng={})),function(e){!function(e){function t(t,e,n,r){t.models=[],e.get("/api/models").then(function(e){t.models=e.data},function(){n.path("/404")}),t.newUrl=function(e){return r.buildUrl(e+"/new")},t.listUrl=function(e){return r.buildUrl(e)}}t.$inject=["$scope","$http","$location","routingService"],e.ModelCtrl=t}(e.controllers||(e.controllers={}))}(fng||(fng={})),function(e){!function(e){function t(i,e,r,t,n){function a(){i.items=[],i.contextMenu=void 0}a(),i.isCollapsed=!0,i.showShortcuts=!1,i.shortcuts=[{key:"?",act:"Show shortcuts"},{key:"/",act:"Jump to search"},{key:"Ctrl+Shift+S",act:"Save the current record"},{key:"Ctrl+Shift+Esc",act:"Cancel changes on the current record"},{key:"Ctrl+Shift+Ins",act:"Create a new record"},{key:"Ctrl+Shift+X",act:"Delete the current record"}],i.markupShortcut=function(e){return'<span class="key">'+e.split("+").join('</span> + <span class="key">')+"</span>"},i.globalShortcuts=function(n){function e(e){var t=document.getElementById(e);t&&(t.disabled||setTimeout(function(){t.click()}),n.preventDefault())}if(191===n.keyCode&&("INPUT"!=(a=((r=n).target||r.srcElement).tagName)&&"SELECT"!=a&&"TEXTAREA"!=a||n.ctrlKey&&!n.altKey&&!n.metaKey))if(n.ctrlKey||!n.shiftKey){var t=document.getElementById("searchinput");t&&(t.focus(),n.preventDefault())}else i.showShortcuts=!0;else 83===n.keyCode&&n.ctrlKey&&n.shiftKey&&!n.altKey&&!n.metaKey?e("saveButton"):27===n.keyCode&&(n.ctrlKey&&n.shiftKey&&!n.altKey&&!n.metaKey||i.showShortcuts)?n.ctrlKey&&n.shiftKey&&!n.altKey&&!n.metaKey?e("cancelButton"):i.showShortcuts=!1:45===n.keyCode&&n.ctrlKey&&n.shiftKey&&!n.altKey&&!n.metaKey?e("newButton"):88===n.keyCode&&n.ctrlKey&&n.shiftKey&&!n.altKey&&!n.metaKey&&e("deleteButton");var r,a},i.css=function(e,t){return"function"==typeof n[e]?n[e](t):"error text-error"},i.$on("fngControllersLoaded",function(e,t,n){i.contextMenu=t.dropDownDisplay||t.modelNameDisplay||r("titleCase")(n,!1)}),i.$on("fngControllersUnloaded",function(e){a()}),i.doClick=function(e,t){var n=angular.element(t.target),r=i.items[e];if(r.divider||n.parent().hasClass("disabled"))t.preventDefault();else if(r.broadcast)i.$broadcast(r.broadcast);else{var a=r.args||[],o=r.fn;switch(a.length){case 0:o();break;case 1:o(a[0]);break;case 2:o(a[0],a[1]);break;case 3:o(a[0],a[1],a[2]);break;case 4:o(a[0],a[1],a[2],a[3])}}},i.isHidden=function(e){return!!i.items[e].isHidden&&i.items[e].isHidden()},i.isDisabled=function(e){return!!i.items[e].isDisabled&&i.items[e].isDisabled()},i.buildUrl=function(e){return t.buildUrl(e)},i.dropdownClass=function(e){var t="";return i.items[e].divider?t="divider":i.isDisabled(e)&&(t="disabled"),t}}t.$inject=["$scope","$location","$filter","routingService","cssFrameworkService"],e.NavCtrl=t}(e.controllers||(e.controllers={}))}(fng||(fng={})),function(e){e.formsAngular=angular.module("formsAngular",["ngSanitize","ngMessages","ui.bootstrap","infinite-scroll","monospaced.elastic"]).controller("BaseCtrl",e.controllers.BaseCtrl).controller("SaveChangesModalCtrl",e.controllers.SaveChangesModalCtrl).controller("ModelCtrl",e.controllers.ModelCtrl).controller("NavCtrl",e.controllers.NavCtrl).directive("modelControllerDropdown",e.directives.modelControllerDropdown).directive("errorDisplay",e.directives.errorDisplay).directive("fngLink",e.directives.fngLink).directive("formInput",e.directives.formInput).directive("formButtons",e.directives.formButtons).directive("globalSearch",e.directives.globalSearch).directive("fngNakedDate",e.directives.fngNakedDate).filter("camelCase",e.filters.camelCase).filter("titleCase",e.filters.titleCase).service("addAllService",e.services.addAllService).provider("cssFrameworkService",e.services.cssFrameworkService).provider("routingService",e.services.routingService).factory("fngModelCtrlService",e.services.fngModelCtrlService).factory("formGenerator",e.services.formGenerator).factory("formMarkupHelper",e.services.formMarkupHelper).factory("inputSizeHelper",e.services.inputSizeHelper).factory("pluginHelper",e.services.pluginHelper).factory("recordHandler",e.services.recordHandler).factory("SchemasService",e.services.SchemasService).factory("SubmissionsService",e.services.SubmissionsService)}(fng||(fng={}));var formsAngular=fng.formsAngular;angular.module("formsAngular").run(["$templateCache",function(e){e.put("base-analysis.html",'<div ng-controller="AnalysisCtrl">\n  <div class="container-fluid page-header report-header">\n    <div ng-class="css(\'rowFluid\')">\n      <div class="header-lhs col-xs-7 span7">\n        <h1>{{ reportSchema.title }}</h1>\n      </div>\n      <div class="header-rhs col-xs-5 span5">\n        <form-input schema="paramSchema" name="paramForm" ng-show="paramSchema" formstyle="horizontalCompact"></form-input>\n      </div>\n    </div>\n  </div>\n  <div class="container-fluid page-body report-body">\n    <error-display></error-display>\n    <div class="row-fluid">\n      <div class="gridStyle" ui-grid="gridOptions" ui-grid-selection></div>\n    </div>\n  </div>\n</div>\n'),e.put("base-edit.html",'<div ng-controller="BaseCtrl">\n    <div ng-class="css(\'rowFluid\')" class="page-header edit-header">\n        <div class="header-lhs col-sm-8 span8">\n            <h4>{{modelNameDisplay}} :\n                <span ng-repeat="field in listSchema">{{getListData(record, field.name)}} </span>\n            </h4>\n        </div>\n        <div class="header-rhs col-sm-2 span2">\n            <div form-buttons></div>\n        </div>\n    </div>\n    <div class="container-fluid page-body edit-body">\n        <error-display></error-display>\n        <form-input name="baseForm" schema="baseSchema()" formstyle="compact"></form-input>\n    </div>\n    \x3c!--{{ formSchema | json }}--\x3e\n</div>\n'),e.put("base-list.html",'<div ng-controller="BaseCtrl">\n    <div ng-class="css(\'rowFluid\')" class="page-header list-header">\n        <div class="header-lhs col-sm-8 span8">\n            <h1>{{modelNameDisplay}}</h1>\n        </div>\n        <div class="header-rhs col-sm-2 span2">\n            <a ng-href="{{generateNewUrl()}}"><button id="newBtn" class="btn btn-default"><i class="icon-plus"></i> New</button></a>\n        </div>\n    </div>\n    <div class="page-body list-body">\n        <error-display></error-display>\n        <div ng-class="css(\'rowFluid\')" infinite-scroll="scrollTheList()">\n            <a ng-repeat="record in recordList" ng-href="{{generateEditUrl(record)}}">\n                <div class="list-item">\n                    <div ng-class="css(\'span\',12/listSchema.length)" ng-repeat="field in listSchema">{{getListData(record, field.name)}} </div>\n                </div>\n            </a>\n        </div>\n    </div>\n</div>\n'),e.put("error-messages.html",'<div ng-message="required">A value is required for this field</div>\n<div ng-message="minlength">Too few characters entered</div>\n<div ng-message="maxlength">Too many characters entered</div>\n<div ng-message="min">That value is too small</div>\n<div ng-message="max">That value is too large</div>\n<div ng-message="email">You need to enter a valid email address</div>\n<div ng-message="pattern">This field does not match the expected pattern</div>\n'),e.put("form-button-bs2.html",'<div class="form-btn-grp">\n  <div class="btn-group pull-right">\n    <button id="saveButton" class="btn btn-mini btn-primary form-btn" ng-click="save()" ng-disabled="isSaveDisabled()"><i class="icon-ok"></i> Save</button>\n    <button id="cancelButton" class="btn btn-mini btn-warning form-btn" ng-click="cancel()" ng-disabled="isCancelDisabled()"><i class="icon-remove"></i> Cancel</button>\n  </div>\n  <div class="btn-group pull-right">\n    <button id="newButton" class="btn btn-mini btn-success form-btn" ng-click="newClick()" ng-disabled="isNewDisabled()"><i class="icon-plus"></i> New</button>\n    <button id="deleteButton" class="btn btn-mini btn-danger form-btn" ng-click="deleteClick()" ng-disabled="isDeleteDisabled()"><i class="icon-minus"></i> Delete</button>\n  </div>\n</div>\n'),e.put("form-button-bs3.html",'<div class="form-btn-grp">\n  <div class="btn-group pull-right">\n    <button id="saveButton" class="btn btn-primary form-btn btn-xs" ng-click="save()" ng-disabled="isSaveDisabled()"><i class="glyphicon glyphicon-ok"></i> Save</button>\n    <button id="cancelButton" class="btn btn-warning form-btn btn-xs" ng-click="cancel()" ng-disabled="isCancelDisabled()"><i class="glyphicon glyphicon-remove"></i> Cancel</button>\n  </div>\n  <div class="btn-group pull-right">\n    <button id="newButton" class="btn btn-success form-btn btn-xs" ng-click="newClick()" ng-disabled="isNewDisabled()"><i class="glyphicon glyphicon-plus"></i> New</button>\n    <button id="deleteButton" class="btn btn-danger form-btn btn-xs" ng-click="deleteClick()" ng-disabled="isDeleteDisabled()"><i class="glyphicon glyphicon-minus"></i> Delete</button>\n  </div>\n</div>\n'),e.put("search-bs2.html",'<form class="navbar-search pull-right">\n    <div id="search-cg" class="control-group" ng-class="errorClass">\n        <input type="text" autocomplete="off" id="searchinput" ng-model="searchTarget" ng-model-options="{debounce:250}" class="search-query" placeholder="{{searchPlaceholder}}" ng-keyup="handleKey($event)">\n    </div>\n</form>\n<div class="results-container" ng-show="results.length >= 1">\n    <div class="search-results">\n        <div ng-repeat="result in results">\n            <span ng-class="resultClass($index)" ng-click="selectResult($index)">{{result.resourceText}} {{result.text}}</span>\n        </div>\n        <div ng-show="moreCount > 0">(plus more - continue typing to narrow down search...)\n        </div>\n    </div>\n</div>\n'),e.put("search-bs3.html",'<form class="pull-right navbar-form">\n    <div id="search-cg" class="form-group" ng-class="errorClass">\n        <input type="text" autocomplete="off" id="searchinput" ng-model="searchTarget" ng-model-options="{debounce:250}" class="search-query form-control" placeholder="{{searchPlaceholder}}" ng-keyup="handleKey($event)">\n    </div>\n</form>\n<div class="results-container" ng-show="results.length >= 1">\n    <div class="search-results">\n        <div ng-repeat="result in results">\n            <span ng-class="resultClass($index)" ng-click="selectResult($index)" title={{result.additional}}>{{result.resourceText}} {{result.text}}</span>\n        </div>\n        <div ng-show="moreCount > 0">(plus more - continue typing to narrow down search...)\n        </div>\n    </div>\n</div>\n')}]);